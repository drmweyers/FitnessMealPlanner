<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EvoFit PDF API Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        button { background: #EB5757; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #d43939; }
        .status { margin-top: 10px; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>üß™ EvoFit PDF Export API Test</h1>
    
    <div class="container">
        <h2>Test Server-Side PDF Generation</h2>
        <p>This will test the new EvoFit PDF export API directly, bypassing any frontend issues.</p>
        <button onclick="testPdfExport()">üéØ Generate EvoFit PDF</button>
        <div id="status"></div>
    </div>

    <div class="container">
        <h2>Expected Result</h2>
        <ul>
            <li>‚úÖ Professional EvoFit-branded PDF download</li>
            <li>‚úÖ Cover page with gradient background (#EB5757 primary)</li>
            <li>‚úÖ Multiple pages: TOC, daily meals, recipes, shopping list, nutrition</li>
            <li>‚úÖ Google Fonts (Montserrat/Roboto)</li>
            <li>‚úÖ Server-side Puppeteer rendering</li>
        </ul>
    </div>

    <script>
        async function testPdfExport() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<div class="status">‚è≥ Generating EvoFit PDF...</div>';

            const testData = {
                mealPlanData: {
                    id: "test-001",
                    planName: "EvoFit 7-Day Transformation",
                    fitnessGoal: "weight_loss",
                    description: "A comprehensive meal plan designed for sustainable weight loss with EvoFit branding",
                    dailyCalorieTarget: 1800,
                    days: 7,
                    mealsPerDay: 3,
                    meals: [
                        {
                            day: 1,
                            mealNumber: 1,
                            mealType: "breakfast",
                            recipe: {
                                id: "recipe-001",
                                name: "EvoFit Protein Pancakes",
                                description: "Fluffy pancakes packed with protein and fiber for your transformation journey",
                                caloriesKcal: 350,
                                proteinGrams: "25",
                                carbsGrams: "35",
                                fatGrams: "8",
                                prepTimeMinutes: 15,
                                servings: 2,
                                mealTypes: ["breakfast"],
                                dietaryTags: ["high-protein", "transformation"],
                                ingredientsJson: [
                                    { name: "Oats", amount: "1", unit: "cup" },
                                    { name: "EvoFit Protein Powder", amount: "1", unit: "scoop" },
                                    { name: "Banana", amount: "1", unit: "medium" },
                                    { name: "Eggs", amount: "2", unit: "large" },
                                    { name: "Almond Milk", amount: "1/2", unit: "cup" }
                                ],
                                instructionsText: "1. Blend all ingredients until smooth. 2. Heat pan over medium heat. 3. Pour batter and cook 2-3 minutes per side. 4. Serve with fresh berries and enjoy your EvoFit meal!"
                            }
                        },
                        {
                            day: 1,
                            mealNumber: 2,
                            mealType: "lunch",
                            recipe: {
                                id: "recipe-002",
                                name: "Power Grilled Chicken Salad",
                                description: "Fresh mixed greens with seasoned grilled chicken breast - perfect for your fitness goals",
                                caloriesKcal: 420,
                                proteinGrams: "35",
                                carbsGrams: "15",
                                fatGrams: "22",
                                prepTimeMinutes: 20,
                                servings: 1,
                                mealTypes: ["lunch"],
                                dietaryTags: ["low-carb", "high-protein", "lean"],
                                ingredientsJson: [
                                    { name: "Chicken Breast", amount: "6", unit: "oz" },
                                    { name: "Mixed Greens", amount: "3", unit: "cups" },
                                    { name: "Cherry Tomatoes", amount: "1/2", unit: "cup" },
                                    { name: "Cucumber", amount: "1/2", unit: "medium" },
                                    { name: "Olive Oil", amount: "2", unit: "tbsp" },
                                    { name: "Lemon Juice", amount: "1", unit: "tbsp" }
                                ],
                                instructionsText: "1. Season and grill chicken breast until cooked through. 2. Chop vegetables and arrange on plate. 3. Slice chicken and add to salad. 4. Drizzle with olive oil and lemon juice. 5. Season to taste and enjoy your EvoFit nutrition!"
                            }
                        },
                        {
                            day: 1,
                            mealNumber: 3,
                            mealType: "dinner",
                            recipe: {
                                id: "recipe-003",
                                name: "EvoFit Salmon Power Bowl",
                                description: "Omega-3 rich salmon with quinoa and vegetables for optimal recovery",
                                caloriesKcal: 480,
                                proteinGrams: "40",
                                carbsGrams: "35",
                                fatGrams: "20",
                                prepTimeMinutes: 25,
                                servings: 1,
                                mealTypes: ["dinner"],
                                dietaryTags: ["omega-3", "recovery", "whole-grain"],
                                ingredientsJson: [
                                    { name: "Salmon Fillet", amount: "6", unit: "oz" },
                                    { name: "Quinoa", amount: "1/2", unit: "cup dry" },
                                    { name: "Broccoli", amount: "1", unit: "cup" },
                                    { name: "Sweet Potato", amount: "1", unit: "small" },
                                    { name: "Lemon", amount: "1/2", unit: "whole" },
                                    { name: "Garlic", amount: "2", unit: "cloves" }
                                ],
                                instructionsText: "1. Preheat oven to 400¬∞F. 2. Cook quinoa according to package instructions. 3. Season salmon with lemon and garlic. 4. Bake salmon for 12-15 minutes. 5. Steam broccoli and roast sweet potato. 6. Combine in bowl and serve your EvoFit power meal!"
                            }
                        }
                    ]
                },
                customerName: "Sarah Johnson",
                options: {
                    includeShoppingList: true,
                    includeMacroSummary: true,
                    includeRecipePhotos: false,
                    orientation: "portrait",
                    pageSize: "A4"
                }
            };

            try {
                const response = await fetch('http://localhost:4000/api/pdf/test-export', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                        // Note: For this test, we're not including auth headers
                        // In production, you'd need: 'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify(testData)
                });

                if (response.ok) {
                    // Get the PDF blob and trigger download
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'EvoFit_Sample_Meal_Plan.pdf';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);

                    statusDiv.innerHTML = '<div class="status success">‚úÖ SUCCESS! EvoFit PDF downloaded successfully!</div>';
                } else {
                    const errorText = await response.text();
                    statusDiv.innerHTML = `<div class="status error">‚ùå Error: ${response.status} - ${errorText}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">‚ùå Network Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>